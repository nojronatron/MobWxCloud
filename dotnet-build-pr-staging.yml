name: DotNET Build and Test PR to Staging

on:
  pull_request:
    branches:
      - staging

  jobs:
    build:
      runs-on: windows-latest

      steps:
        - name: Checkout code
          uses: actions/checkout@v4

        - name: Setup .NET 8.0
          uses: actions/setup-dotnet@v3
          with:
            dotnet-version: '8.0.x'

        - name: Cache DotNET Packages
          uses: actions/cache@v3
          with:
            path: ~/.nuget/packages
            key: ${{ runner.os }}-nuget-${{ hashFiles('**/*.csproj') }}
            restore-keys: |
              ${{ runner.os }}-nuget-

        - name: Restore Workloads
          run: dotnet workload restore ./MobWxCloud.sln
          working-directory: .

        - name: Build
          run: dotnet build ./MobWxCloud.sln
          working-directory: .

        - name: Test
          run: dotnet test ./MobWxCloud.sln --no-build --verbosity normal
          working-directory: .
 